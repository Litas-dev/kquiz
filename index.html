<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KQuiz — Klausimų kūrėjas (LT, be pranešimų)</title>
  <style>
    :root{--bg:#0f1115;--panel:#161a22;--muted:#9aa4b2;--text:#e6e9ef;--accent:#4da3ff;--danger:#ff5d5d;--radius:14px;--gap:12px;--maxw:760px}
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:18px}
    .card{background:var(--panel);border-radius:var(--radius);padding:16px 14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:grid;grid-template-columns:1fr;gap:var(--gap)}
    label{font-size:.9rem;color:var(--muted)}
    input[type="text"],textarea,select{width:100%;padding:14px 12px;border:1px solid #242a36;background:#0b0e14;color:var(--text);border-radius:12px;font-size:16px;outline:none}
    textarea{min-height:90px;resize:vertical}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:var(--gap)}
    @media (max-width:520px){.grid-2{grid-template-columns:1fr}}
    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{border:0;padding:12px 14px;border-radius:12px;cursor:pointer;font-weight:600;font-size:15px}
    .primary{background:var(--accent);color:#06101f}
    .ghost{background:transparent;color:var(--text);border:1px solid #2a3342}
    .danger{background:transparent;color:var(--danger);border:1px solid #3a2226}
    .hint{font-size:.85rem;color:var(--muted)}
    .section-title{margin:22px 4px 10px;font-weight:700}
    .list{margin-top:12px;display:grid;gap:10px}
    .item{background:#0b0e14;border:1px solid #1e2430;border-radius:12px;padding:12px}
    .item h4{margin:.2rem 0 .4rem 0;font-size:1rem}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#1a2635;color:#bcd2f0;font-size:.75rem;margin-right:6px}
    input,textarea,select,button{min-height:44px}
  </style>
</head>
<body>
  <main class="wrap">
    <h1 style="margin:0 0 14px">KQuiz — Klausimų kūrėjas</h1>
    <p class="hint" style="margin-top:-6px">Jokių iššokančių langų. Rašyk laisvai. Tikrinama tik spaudžiant „Pridėti“ arba „Atsisiųsti“.</p>

    <section class="card row" id="formCard">
      <div class="row">
        <div>
          <label for="q">Klausimas</label>
          <textarea id="q" placeholder="Įrašyk pilną klausimą"></textarea>
        </div>
      </div>

      <div class="grid-2">
        <div>
          <label for="a">Atsakymas A</label>
          <input id="a" type="text" placeholder="Variantas A" />
        </div>
        <div>
          <label for="b">Atsakymas B</label>
          <input id="b" type="text" placeholder="Variantas B" />
        </div>
        <div>
          <label for="c">Atsakymas C</label>
          <input id="c" type="text" placeholder="Variantas C" />
        </div>
        <div>
          <label for="d">Atsakymas D</label>
          <input id="d" type="text" placeholder="Variantas D" />
        </div>
      </div>

      <div class="grid-2">
        <div>
          <label for="correct">Teisingas variantas</label>
          <select id="correct">
            <option value="">Pasirink</option>
            <option value="A">A</option><option value="B">B</option>
            <option value="C">C</option><option value="D">D</option>
          </select>
        </div>
        <div>
          <label for="note">Pastaba (nebūtina)</label>
          <input id="note" type="text" placeholder="Paaiškinimas, šaltinis ar užuomina" />
        </div>
      </div>

      <div class="grid-2">
        <div>
          <label for="cat">Kategorija (nebūtina)</label>
          <input id="cat" type="text" placeholder="pvz., Istorija, Sportas" />
        </div>
        <div>
          <label for="diff">Sunkumas</label>
          <select id="diff">
            <option value="hard">Sunku</option>
            <option value="medium">Vidutinis</option>
            <option value="easy">Lengva</option>
          </select>
        </div>
      </div>

      <div class="btns">
        <button class="primary" id="addBtn">Pridėti klausimą</button>
        <button class="ghost" id="downloadBtn">Atsisiųsti JSON</button>
        <button class="danger" id="clearBtn" title="Išvalyti tik formą">Išvalyti formą</button>
      </div>

      <p id="inlineMsg" class="hint" aria-live="polite"></p>
    </section>

    <h3 class="section-title">Juodraštis</h3>
    <section class="card">
      <div id="count" class="hint">0 įrašų</div>
      <div id="list" class="list" role="list"></div>
    </section>
  </main>

  <script>
    // Būsena
    const data = [];

    // Elementai
    const $ = id => document.getElementById(id);
    const q=$("q"), a=$("a"), b=$("b"), c=$("c"), d=$("d"), correct=$("correct"), note=$("note");
    const cat=$("cat"), diff=$("diff");
    const addBtn=$("addBtn"), downloadBtn=$("downloadBtn"), list=$("list"), count=$("count"), msg=$("inlineMsg"), clearBtn=$("clearBtn");

    // Pagalbinės
    function inform(text, color="#9aa4b2"){ msg.textContent=text||""; msg.style.color=color; }
    function s(v){ return (v||"").trim(); }

    function validateOnce(){
      const Q=s(q.value), A=s(a.value), B=s(b.value), C=s(c.value), D=s(d.value), K=s(correct.value);
      if(!Q) return {ok:false, why:"Reikalingas klausimas."};
      if(!A||!B||!C||!D) return {ok:false, why:"Reikalingi visi keturi atsakymai."};
      if(!["A","B","C","D"].includes(K)) return {ok:false, why:"Pasirink teisingą variantą."};
      const uniq=new Set([A,B,C,D].map(x=>x.toLowerCase()));
      if(uniq.size<4) return {ok:false, why:"Atsakymai turi skirtis."};
      return {ok:true};
    }

    function escapeHtml(s){
      return s.replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    function render(){
      list.innerHTML="";
      count.textContent = data.length + (data.length===1 ? " įrašas" : " įrašų");
      data.forEach((it,idx)=>{
        const el=document.createElement("div");
        el.className="item";
        el.innerHTML=`
          <h4>${idx+1}. ${escapeHtml(it.q)}</h4>
          <div>
            <span class="pill" style="background:#132b1d;color:#b5f3c8">Teisingas: ${escapeHtml(it.correct)}</span>
            ${it.wrong.map(w=>`<span class="pill">${escapeHtml(w)}</span>`).join("")}
            ${it.cat?`<span class="pill">Kategorija: ${escapeHtml(it.cat)}</span>`:""}
            <span class="pill">Sunkumas: ${escapeHtml(it.diff)}</span>
          </div>
          ${it.note?`<p class="hint" style="margin:.6rem 0 0">${escapeHtml(it.note)}</p>`:""}
          <div class="btns" style="margin-top:10px">
            <button class="ghost" data-act="edit" data-i="${idx}">Redaguoti</button>
            <button class="danger" data-act="remove" data-i="${idx}">Pašalinti</button>
          </div>
        `;
        list.appendChild(el);
      });
    }

    function clearForm(){
      q.value=a.value=b.value=c.value=d.value=note.value=cat.value="";
      correct.value=""; diff.value="hard";
      inform(""); q.focus();
    }

    // Pridėti: suformuoja norimą schemą { q, correct, wrong[], cat, diff, note }
    addBtn.addEventListener("click", ()=>{
      const check=validateOnce();
      if(!check.ok){ inform(check.why,"#ff8080"); return; }

      const opts=[s(a.value),s(b.value),s(c.value),s(d.value)];
      const k=s(correct.value);           // "A"|"B"|"C"|"D"
      const kIdx={A:0,B:1,C:2,D:3}[k];
      const correctText=opts[kIdx];
      const wrong=opts.filter((_,i)=>i!==kIdx);

      const item={
        q:s(q.value),
        correct: correctText,
        wrong: wrong,
        cat: s(cat.value),
        diff: s(diff.value)||"hard",
        note: s(note.value)
      };

      data.push(item);
      render();
      clearForm();
      inform("Įrašyta.","#7ad27a");
    });

    // Redagavimas ir šalinimas
    list.addEventListener("click",(e)=>{
      const btn=e.target.closest("button"); if(!btn) return;
      const act=btn.dataset.act, i=+btn.dataset.i;
      if(Number.isNaN(i)||!data[i]) return;

      if(act==="remove"){ data.splice(i,1); render(); inform("Pašalinta.","#ffb27a"); }

      if(act==="edit"){
        const it=data[i];
        // Atstatome į A-D: A=teisingas, B-D=wrong
        const opts=[it.correct, ...(it.wrong||[])];
        q.value=it.q||"";
        a.value=opts[0]||""; b.value=opts[1]||""; c.value=opts[2]||""; d.value=opts[3]||"";
        correct.value="A";
        note.value=it.note||"";
        cat.value=it.cat||"";
        diff.value=it.diff||"hard";
        data.splice(i,1);
        render();
        inform("Įkelta į formą redagavimui.","#c7d3ff");
        q.focus();
      }
    });

    // Eksportas: tiksliai tokia pati schema
    downloadBtn.addEventListener("click", ()=>{
      if(data.length===0){ inform("Nėra ką eksportuoti.","#ff8080"); return; }
      const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
      const aTag=document.createElement("a");
      aTag.href=URL.createObjectURL(blob);
      aTag.download="questions.json";
      document.body.appendChild(aTag);
      aTag.click();
      aTag.remove();
      inform("JSON atsisiųstas.","#7ad27a");
    });

    clearBtn.addEventListener("click", clearForm);

    // NĖRA oninput validacijos. Tik patogus autosize klausimui.
    $("q").addEventListener("input", ()=>{
      q.style.height="auto";
      q.style.height=Math.min(q.scrollHeight,300)+"px";
    });
  </script>
</body>
</html>


