<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KQuiz — Question Builder (No popups)</title>
  <style>
    :root {
      --bg:#0f1115; --panel:#161a22; --muted:#9aa4b2; --text:#e6e9ef; --accent:#4da3ff; --danger:#ff5d5d;
      --radius:14px; --gap:12px; --maxw:760px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:18px}
    .card{background:var(--panel);border-radius:var(--radius);padding:16px 14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:grid;grid-template-columns:1fr;gap:var(--gap)}
    label{font-size:.9rem;color:var(--muted)}
    input[type="text"], textarea, select{
      width:100%;padding:14px 12px;border:1px solid #242a36;background:#0b0e14;color:var(--text);
      border-radius:12px;font-size:16px;outline:none
    }
    textarea{min-height:90px;resize:vertical}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:var(--gap)}
    @media (max-width:520px){ .grid-2{grid-template-columns:1fr} }
    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{
      border:0;padding:12px 14px;border-radius:12px;cursor:pointer;font-weight:600;font-size:15px
    }
    .primary{background:var(--accent);color:#06101f}
    .ghost{background:transparent;color:var(--text);border:1px solid #2a3342}
    .danger{background:transparent;color:var(--danger);border:1px solid #3a2226}
    .hint{font-size:.85rem;color:var(--muted)}
    .section-title{margin:22px 4px 10px;font-weight:700}
    .list{margin-top:12px;display:grid;gap:10px}
    .item{background:#0b0e14;border:1px solid #1e2430;border-radius:12px;padding:12px}
    .item h4{margin:.2rem 0 .4rem 0;font-size:1rem}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#1a2635;color:#bcd2f0;font-size:.75rem;margin-right:6px}
    .sr{position:absolute;left:-9999px}
    /* Large touch targets */
    input,textarea,select,button{min-height:44px}
  </style>
</head>
<body>
  <main class="wrap">
    <h1 style="margin:0 0 14px">KQuiz — Question Builder</h1>
    <p class="hint" style="margin-top:-6px">Zero popups. Type freely. Validation occurs only when you add or export.</p>

    <section class="card row" id="formCard">
      <div class="row">
        <div>
          <label for="q">Question</label>
          <textarea id="q" placeholder="Write the full question"></textarea>
        </div>
      </div>

      <div class="grid-2">
        <div>
          <label for="a">Answer A</label>
          <input id="a" type="text" placeholder="Option A" />
        </div>
        <div>
          <label for="b">Answer B</label>
          <input id="b" type="text" placeholder="Option B" />
        </div>
        <div>
          <label for="c">Answer C</label>
          <input id="c" type="text" placeholder="Option C" />
        </div>
        <div>
          <label for="d">Answer D</label>
          <input id="d" type="text" placeholder="Option D" />
        </div>
      </div>

      <div class="grid-2">
        <div>
          <label for="correct">Correct answer</label>
          <select id="correct">
            <option value="">Select</option>
            <option value="A">A</option><option value="B">B</option>
            <option value="C">C</option><option value="D">D</option>
          </select>
        </div>
        <div>
          <label for="note">Note (optional)</label>
          <input id="note" type="text" placeholder="Explanation, source, hint" />
        </div>
      </div>

      <div class="btns">
        <button class="primary" id="addBtn">Add question</button>
        <button class="ghost" id="downloadBtn">Download JSON</button>
        <button class="danger" id="clearBtn" title="Clear inputs only">Clear form</button>
      </div>

      <p class="hint">Tip: paste with newlines. No auto-toasts. No keystroke validation.</p>
      <p id="inlineMsg" class="hint" aria-live="polite"></p>
    </section>

    <h3 class="section-title">Draft set</h3>
    <section class="card">
      <div id="count" class="hint">0 items</div>
      <div id="list" class="list" role="list"></div>
    </section>
  </main>

  <script>
    // State
    const data = [];

    // Elements
    const $ = id => document.getElementById(id);
    const q = $("q"), a=$("a"), b=$("b"), c=$("c"), d=$("d"), correct=$("correct"), note=$("note");
    const addBtn=$("addBtn"), downloadBtn=$("downloadBtn"), list=$("list"), count=$("count"), msg=$("inlineMsg"), clearBtn=$("clearBtn");

    // Utility: soft inline message (non-blocking, no alerts)
    function inform(text, color="#9aa4b2"){ msg.textContent = text || ""; msg.style.color = color; }

    function sanitize(s){ return (s||"").trim(); }

    function validateOnce() {
      // Run only on explicit actions
      const Q = sanitize(q.value), A = sanitize(a.value), B = sanitize(b.value), C = sanitize(c.value), D = sanitize(d.value);
      const K = sanitize(correct.value);
      if(!Q) return {ok:false, why:"Question is required."};
      const opts = [A,B,C,D];
      if(opts.some(v => !v)) return {ok:false, why:"All four answers are required."};
      if(!["A","B","C","D"].includes(K)) return {ok:false, why:"Select the correct answer."};
      // prevent duplicates within the same item to reduce garbage
      const uniq = new Set(opts.map(v => v.toLowerCase()));
      if(uniq.size < 4) return {ok:false, why:"Answers must be unique."};
      return {ok:true};
    }

    function render() {
      list.innerHTML = "";
      count.textContent = data.length + (data.length===1 ? " item" : " items");
      data.forEach((item, idx)=>{
        const el = document.createElement("div");
        el.className = "item";
        el.innerHTML = `
          <h4>${idx+1}. ${escapeHtml(item.question)}</h4>
          <div>
            <span class="pill">A: ${escapeHtml(item.answers[0])}</span>
            <span class="pill">B: ${escapeHtml(item.answers[1])}</span>
            <span class="pill">C: ${escapeHtml(item.answers[2])}</span>
            <span class="pill">D: ${escapeHtml(item.answers[3])}</span>
            <span class="pill" style="background:#132b1d;color:#b5f3c8">Correct: ${item.correct}</span>
          </div>
          ${item.note ? `<p class="hint" style="margin:.6rem 0 0">${escapeHtml(item.note)}</p>` : ""}
          <div class="btns" style="margin-top:10px">
            <button class="ghost" data-act="edit" data-i="${idx}">Edit</button>
            <button class="danger" data-act="remove" data-i="${idx}">Remove</button>
          </div>
        `;
        list.appendChild(el);
      });
    }

    function escapeHtml(s){
      return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    function clearForm() {
      q.value = a.value = b.value = c.value = d.value = note.value = "";
      correct.value = "";
      inform("");
      q.focus();
    }

    addBtn.addEventListener("click", () => {
      const check = validateOnce();
      if(!check.ok){ inform(check.why, "#ff8080"); return; }
      const item = {
        question: sanitize(q.value),
        answers: [sanitize(a.value), sanitize(b.value), sanitize(c.value), sanitize(d.value)],
        correct: sanitize(correct.value),
        note: sanitize(note.value)
      };
      data.push(item);
      render();
      clearForm();
      inform("Added.", "#7ad27a");
    });

    list.addEventListener("click", (e)=>{
      const btn = e.target.closest("button"); if(!btn) return;
      const act = btn.dataset.act, i = +btn.dataset.i;
      if(Number.isNaN(i) || !data[i]) return;
      if(act==="remove"){ data.splice(i,1); render(); inform("Removed.", "#ffb27a"); }
      if(act==="edit"){
        const it = data[i];
        q.value = it.question;
        a.value = it.answers[0]; b.value = it.answers[1]; c.value = it.answers[2]; d.value = it.answers[3];
        correct.value = it.correct; note.value = it.note || "";
        data.splice(i,1);
        render();
        inform("Loaded to form for editing.", "#c7d3ff");
        q.focus();
      }
    });

    downloadBtn.addEventListener("click", () => {
      if(data.length===0){ inform("Nothing to export.", "#ff8080"); return; }
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
      const aTag = document.createElement("a");
      aTag.href = URL.createObjectURL(blob);
      aTag.download = "kquiz_questions.json";
      document.body.appendChild(aTag);
      aTag.click();
      aTag.remove();
      inform("Exported JSON.", "#7ad27a");
    });

    clearBtn.addEventListener("click", clearForm);

    // Important: NO oninput/keyup validation. Users can type freely.
    // Only run validateOnce() on explicit actions.

    // Quality-of-life: simple autosize for textarea without notifications
    q.addEventListener("input", () => {
      q.style.height = "auto";
      q.style.height = Math.min(q.scrollHeight, 300) + "px";
    });
  </script>
</body>
</html>

